{
    "contents" : "EEPC <- read.csv(\"../Data/EEPC Risk Analysis.csv\", stringsAsFactors=FALSE)\nTotal <- read.csv(\"../Data/EEPC Total.csv\", stringsAsFactors=FALSE)\nset.seed(123)\nsummary(EEPC$Amount)\nlibrary(moments)\nlibrary(dplyr)\nlibrary(GLDEX)\nlibrary(MASS)\nskewness(EEPC$Amount)\nkurtosis(EEPC$Amount)\n\n#Exponential distribution\nN=nrow(EEPC)\nexp_rate=fitdistr(EEPC$Amount,densfun = \"exponential\")\nexp_rate$estimate\nexp_ml=1/mean(EEPC$Amount)\nhist(EEPC$Amount,xlim = c(0,1e6),breaks = 5e2,freq = F,\n     main=\"Histogram with Exponential Distribution\",\n     col=\"green\",xaxt=\"n\",yaxt=\"n\",\n     xlab=\"EEPC Law Suit Cost (in thousands)\")\nxrange=seq.int(0,1e6,by = 100)\nyexp=dexp(xrange,exp_rate$estimate)\nlines(x = xrange,y = yexp,lwd=3,col=\"blue\")\nxrange=seq.int(0,1e6,by = 2e5)\nxlabel=paste(\"$\",xrange/1000)\naxis(1,at=xrange,labels = xlabel)\nyrange=seq.int(0,1.2e-5,by = 2e-6)\nylabel=paste(yrange*100,\"%\",sep=\"\")\naxis(2,at=yrange,labels = ylabel)\n\nrand_exp=rexp(1e5,rate = exp_rate$estimate)\nexprange=c(0,1e6)\nqqplot(EEPC$Amount,rand_exp,col=\"darkgrey\",pch=19,xlim=exprange,ylim=exprange,\n       ylab=\"Exponential Distribution\",xlab=\"EEPC Law Suit Costs\",main=\"QQ-plot\")\nabline(0,1,col=\"red\",lty=3,lwd=2)\n\nks.gof(EEPC$Amount,\"pexp\",rate = exp_rate$estimate)\n\n\n#LogNormal\nEEPC$LogAmount=log(EEPC$Amount)\nlnorm_rate=fitdistr(EEPC$Amount,densfun = \"log-normal\")\nlnorm_rate$estimate\nhist(EEPC$Amount,xlim = c(0,1e6),breaks = 5e2,freq = F,\n     main=\"Histogram with Log-Normal Distribution\",\n     col=\"yellow\",xaxt=\"n\",yaxt=\"n\",\n     xlab=\"EEPC Law Suit Cost (in thousands)\")\nxrange=seq.int(0,1e6,by = 100)\nylog=dlnorm(xrange,meanlog = lnorm_rate$estimate[\"meanlog\"],\n            sdlog = lnorm_rate$estimate[\"sdlog\"])\nlines(x = xrange,y = ylog,lwd=3,col=\"purple\")\nxrange=seq.int(0,1e6,by = 2e5)\nxlabel=paste(\"$\",xrange/1000)\naxis(1,at=xrange,labels = xlabel)\nyrange=seq.int(0,1.4e-5,by = 2e-6)\nylabel=paste(yrange*100,\"%\",sep=\"\")\naxis(2,at=yrange,labels = ylabel)\n\n\nks.gof(EEPC$Amount,\"plnorm\",meanlog = lnorm_rate$estimate[\"meanlog\"],\n       sdlog = lnorm_rate$estimate[\"sdlog\"])\n\n\nnorm_rate=fitdistr(EEPC$LogAmount,densfun = \"normal\")\nnorm_rate$estimate\nEEPC %>% summarise(mean=mean(LogAmount),sd=sd(LogAmount))\nhist(EEPC$LogAmount,freq = F,xlim = c(6,14),breaks = 20,\n     main=\"Histogram with Normal Distribution\",\n     col=\"pink\",yaxt=\"n\",\n     xlab=\"EEPC Law Suit Cost (Log Scale)\")\nxrange=seq.int(0,18,by = .1)\nynorm=dnorm(xrange,mean = norm_rate$estimate[\"mean\"],\n            sd = norm_rate$estimate[\"sd\"])\nlines(x = xrange,y = ynorm,lwd=3,col=\"darkgreen\")\n\nyrange=seq.int(0,0.4,by = 0.05)\nylabel=paste(yrange*100,\"%\",sep=\"\")\naxis(2,at=yrange,labels = ylabel,las=2,cex=.5)\n\nrand_lnorm=rlnorm(1e5,meanlog = lnorm_rate$estimate[\"meanlog\"],\n                 sdlog = lnorm_rate$estimate[\"sdlog\"])\nexprange=c(0,1e6)\nqqplot(EEPC$Amount,rand_lnorm,\n       col=\"darkblue\",pch=19,xlim=exprange,ylim=exprange)\nabline(0,1,col=\"red\",lty=3,lwd=3)\n\n#Loss Frequence Model\nyear=EEPC %>% group_by(year.settled) %>% summarise(AvgAmount=mean(Amount),N=n())\nlibrary(moments)\nyear %>% summarise(Avg=mean(N),Var=var(N),Median=median(N),\n                   skewness(N),kurtosis(N))\n#Because sample variance is much larger than sample mean\n#use Negative Binomial\n\n\nnb_param=fitdistr(year$N,\"Negative Binomial\")\nrnbinom(n=8,size = nb_param$estimate[\"size\"],mu = nb_param$estimate[\"mu\"])\n\nks.gof(year$N,\"pnbinom\",size = nb_param$estimate[\"size\"],\n       mu = nb_param$estimate[\"mu\"])\n\n\n\n\n#Aggregated loss\ntotal_cost=rep(0,5e4)\nfor(i in 1:5e4){\n    num_case=rnbinom(n=1,size = nb_param$estimate[\"size\"],\n                     mu = nb_param$estimate[\"mu\"])\n    for(j in 1:num_case){\n        total_cost[i]=total_cost[i]+\n            rlnorm(n=1,meanlog = lnorm_rate$estimate[\"meanlog\"],\n                   sdlog = lnorm_rate$estimate[\"sdlog\"])\n    }\n}\nsummary(total_cost)\nlnorm_parm=fitdistr(total_cost,densfun = \"log-normal\")\nhist(total_cost,xlim = c(0,2e7),ylim=c(0,2.5e-7),breaks = 1e2,freq = F,\n     main=\"Histogram with Log-Normal Distribution\",\n     col=\"yellow\",xaxt=\"n\",#yaxt=\"n\",\n     xlab=\"EEPC Law Suit Cost (in millions)\")\nxrange=seq.int(0,2e7,by = 100)\nylog=dlnorm(xrange,meanlog = lnorm_parm$estimate[\"meanlog\"],\n            sdlog = lnorm_parm$estimate[\"sdlog\"])\nlines(x = xrange,y = ylog,lwd=3,col=\"purple\")\nxrange=seq.int(0,2e7,by = 5e6)\nxlabel=paste(\"$\",xrange/1e6,sep=\"\")\naxis(1,at=xrange,labels = xlabel)\n\n\nTotal[,c(1,4)]\nsumary(Total$Total)\n\n#Kolmogorov-Smirnov test\nlibrary(GLDEX)\nks.gof(Total$Total,total_cost)\nks.gof(Total$Total,\"plnorm\",meanlog = lnorm_parm$estimate[\"meanlog\"],\n       sdlog = lnorm_parm$estimate[\"sdlog\"])\n\n\n\nlibrary(ggplot2)\n\nggplot(EEPC,aes(x=LogAmount))+\n    geom_histogram(aes(y=..density..),fill=\"blue\",alpha=0.5,binwidth=1)+\n    geom_density(color=\"yellow\")+xlab(expression(bold(\"Law Suit Cost (in log scale)\")))+\n    ylab(expression(bold(\"Density\")))\n\n\n#Gamma Distribution\ngamma_param=EEPC %>% summarise(scale=var(Amount)/mean(Amount),\n                               shape=(mean(Amount)/sd(Amount))^2)\n\n# gamma_rate=fitdistr(EEPC$Amount,dgamma, list(scale = 1e7,shape = 1e-2),\n#                     lower=1e-5)\n# \n# gamma_rate$estimate\n\nhist(EEPC$Amount,xlim = c(0,1e6),breaks = 5e2,freq = F,\n     main=\"Histogram with Gamma Distribution\",\n     col=\"palegreen\",xaxt=\"n\",yaxt=\"n\",\n     xlab=\"EEPC Law Suit Cost (in thousands)\")\nxrange=seq.int(0,1e6,by = 100)\nylog=dgamma(xrange,shape = gamma_param$shape,scale = gamma_param$scale)\nlines(x = xrange,y = ylog,lwd=3,col=\"violetred\")\nxrange=seq.int(0,1e6,by = 2e5)\nxlabel=paste(\"$\",xrange/1000)\naxis(1,at=xrange,labels = xlabel)\nyrange=seq.int(0,1.4e-5,by = 2e-6)\nylabel=paste(yrange*100,\"%\")\naxis(2,at=yrange,labels = ylabel)\n\n#Weibull distribution\nwb_param=fitdistr(EEPC$Amount,densfun = \"weibull\")\n\ntila_X=function(n){\n    sum(log(log(1/(1-(1:n)/(n+1)))))/n\n}\n\n\n\n\n\nn=nrow(EEPC)\nEEPC=EEPC %>% mutate(P=rank(Amount,ties.method = \"min\"))\n\n\nwb_beta=function(){\n    \n}\n\n\n\n\n\n\n\n\nhist(EEPC$Amount,xlim = c(0,1e6),breaks = 5e2,freq = F,\n     main=\"Histogram with Weibull Distribution\",\n     col=\"green\",xaxt=\"n\",yaxt=\"n\",\n     xlab=\"EEPC Law Suit Cost (in thousands)\")\nxrange=seq.int(0,1e6,by = 100)\nyweibull=dweibull(xrange,shape = wb_param$estimate[\"shape\"],\n                  scale = wb_param$estimate[\"scale\"])\nlines(x = xrange,y = yweibull,lwd=3,col=\"blue\")\nxrange=seq.int(0,1e6,by = 2e5)\nxlabel=paste(\"$\",xrange/1000)\naxis(1,at=xrange,labels = xlabel)\nyrange=seq.int(0,1.2e-5,by = 2e-6)\nylabel=paste(yrange*100,\"%\",sep=\"\")\naxis(2,at=yrange,labels = ylabel)\n\nrand_weibull=rweibull(1e4,shape = wb_param$estimate[\"shape\"],\n                  scale = wb_param$estimate[\"scale\"])\nexprange=c(0,1e6)\nqqplot(EEPC$Amount,rand_weibull,\n       col=\"turquoise\",pch=19,xlim=exprange,ylim=exprange)\n\n\n\n\n\n\n\nEEPC$zAmount=scale(EEPC$Amount)\n\n\nestBetaParams <- function(x) {\n  mu=mean(x)\n  var=var(x)\n  alpha <- ((1 - mu) / var - 1 / mu) * mu ^ 2\n  beta <- alpha * (1 / mu - 1)\n  return(params = list(alpha = alpha, beta = beta))\n}\n\n\n\nlogNormParams=fitdistr(EEPC$Amount,densfun = \"log-normal\")\n\n\n\nqqplot(EEPC$Amount,rlnorm(N,meanlog = ))\n\n\nbetaParams=estBetaParams(EEPC$LogAmount)\nqqplot(EEPC$LogAmount,rbeta(N,betaParams$alpha,betaParams$beta))\n\nsummary(EEPC$LogAmount)\nhist(EEPC$LogAmount)",
    "created" : 1435703762404.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2281271869",
    "id" : "A39DC2D1",
    "lastKnownWriteTime" : 1436315391,
    "path" : "C:/Users/David/Desktop/Risk Analysis/Code/EEPC.R",
    "project_path" : "EEPC.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}